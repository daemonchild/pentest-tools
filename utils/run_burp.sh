#!/usr/bin/env bash

#      _                                       _     _ _     _
#   __| | __ _  ___ _ __ ___   ___  _ __   ___| |__ (_) | __| |
#  / _` |/ _` |/ _ \ '_ ` _ \ / _ \| '_ \ / __| '_ \| | |/ _` |
# | (_| | (_| |  __/ | | | | | (_) | | | | (__| | | | | | (_| |
#  \__,_|\__,_|\___|_| |_| |_|\___/|_| |_|\___|_| |_|_|_|\__,_|
#

# Title:	  Run Burp
# Version:	1.0
# Purpose:	Runs the latest version of Burp, setting memory model
# Requires: BurpSuite Pro .jar file

# Usage:
#     Edit below 'BurpDir' variable to point to where you store your Burp .jar files.
#		  run_burp.sh

# EDIT HERE, uncomment line
# BURPDIR=
JAVAGBRAM=3
# BUT NOT BELOW HERE

echo --- Running BurpSuite Pro ---

# Calculate the memory requirements in MB
JAVAMBRAM=$(expr $JAVAGBRAM \* 1024)

# If you didn't set a value for the BurpDir, ask for it.
while [ -z ${BURPDIR+x} ]; do
  echo -n "- Supply folder where Burp .jar files are located: "
  read SOMEDIR

  # Basic check that this folder exists
  if [[ -d $SOMEDIR ]]
  then
    BURPDIR=$SOMEDIR
    SEDDIR=$(sed 's/\//\\\//g' <<< $BURPDIR)

    # Operating System Detection
    MYOS=$(uname -s)

    # Update the BurpDir variable in this script :)
    echo "-- Updated this script to avoid asking again."
    if test $MYOS == "Linux" ; then
      sed -i  "0,/# BURPDIR=/s/# BURPDIR=/BURPDIR=$SEDDIR/" $0
    fi

    if test $MYOS == "Darwin" ; then
      sed -i ".bak" "1,/# BURPDIR=/s/# BURPDIR=/BURPDIR=$SEDDIR/" $0
    fi

  else  echo "-- Folder $BURPDIR does not exist!"; fi
done

# Basic check that this folder exists
if [[ -d $BURPDIR ]]
then

  echo -n "- Choosing newest Burp .jar file: "

  BURP=$(basename $(ls -t $BURPDIR/burpsuite_pro_*.jar | head -n1))
  echo $BURP

  echo "- Launching $BURP with ${JAVAGBRAM}GB (${JAVAMBRAM}MB) memory"
  
  java -Xmx${JAVAMBRAM}m -jar $BURPDIR/$BURP &

  echo "- Script finished"

else
  echo "-- Folder $BURPDIR does not exist!"
fi
